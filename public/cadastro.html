<!DOCTYPE html>
<html lang="pt-BR, en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JDM Classics - Cadastro</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="./imgs/favicon.ico">
</head>

<body style="background-color: #3c3c3c;">

    <header>
        <div class="container">
            <img src="./imgs/logo.png" alt="">
        </div>
    </header>

    <div id="id_modal" class="modal">
        <div id="id_content" class="contentModal">
            <header class="modalHeader">
                <h2 id="modalTitle">Erro!</h2>
            </header>
            <div class="container">
                <p id="modalDesc">Preencha todos os campos para prosseguir!</p>
            </div>
            <footer id="modalBottom" class="modalFooter">
                <button class="btn_cadastro btn_modal" onclick="fecharModal()">Fechar</button>
            </footer>
        </div>
    </div>

    <div class="container cadastro">
        <div class="formbox">
            <div class="cont">
                <div class="formulario">
                    <h2>Cadastro</h2>
                        <div class="wrap pair">
                            <div class="wrap">
                                <span>Primeiro Nome:</span>
                                <input type="text" id="inp_nome">
                            </div>
                            <div class="wrap">
                                <span style="margin-left: 10%;">Sobrenome:</span>
                                <input style="margin-left: 10%;" type="text" id="inp_sobrenome">
                            </div>
                        </div>
                        <div class="wrap">
                            <span>E-Mail:</span>
                            <input type="text" id="inp_email">
                        </div>
                        <div class="wrap">
                            <span>Senha:</span>
                            <input type="password" id="inp_senha">
                        </div>
                        <div class="wrap">
                            <span>Confirmar senha:</span>
                            <input type="password" id="inp_confSenha">
                        </div>
                        <button class="btn_cadastro" onclick="cadastar()">Confirmar</button>
                </div>
            </div>
            <div class="cont img"></div>
        </div>
    </div>
</body>
</html>

<script src="funcoes.js"></script>

<script>

    function cadastar() {
        var nome = inp_nome.value
        var sobrenome = inp_sobrenome.value
        var email = inp_email.value
        var senha = inp_senha.value
        var cSenha = inp_confSenha.value

        if (
            nome == "" ||
            sobrenome == "" ||
            email == "" ||
            senha == "" ||
            cSenha == "" 
        ) {
            return abrirModal()
        }

        if (!email.includes("@") || !email.includes(".com")) {
            modalDesc.innerHTML = "Email Inválido!"
            return abrirModal()
        }

        if (!(senha == cSenha)) {
            modalDesc.innerHTML = "A confirmação de senha deve ser igual a senha inserida!"
            return abrirModal()
        }

        fetch("/mainRoutes/entrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: email,
                senhaServer: senha
            })
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")
            if (resposta.length > 0) {
                modalDesc.innerHTML = "E-Mail já cadastrado!"
                return abrirModal()
            }
        })
        .catch(function (erro) {
        console.log(erro);
        });


        fetch("/mainRoutes/cadastrar", {
            method: "POST",
            headers: {
            "Content-Type": "application/json",
            },
            body: JSON.stringify({
            nomeServer: nome,
            sobrenomeServer: sobrenome,
            emailServer: email,
            senhaServer: senha
            })
        }).then(function (resposta) {
            console.log("resposta: ", resposta);

            if (resposta.ok) {
                modalTitle.innerHTML = "Sucesso!";
                modalDesc.innerHTML = "Cadastro realizado com sucesso!";
                modalBottom.innerHTML = ""
                abrirModal()
                // window.location(login.html)
            } else {
                modalDesc.innerHTML = `Não foi possível realizar seu cadastro`;
                abrirModal()
            }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
        });

    }

</script>